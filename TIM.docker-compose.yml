version: '3'
services:

  tim_python_v3.10:
    env_file: $TIM_ENV_FILE
    image: tim_python_v3.10:latest
    build:
      args:
        - PYCTI
        - BASE_DIR
      context: $BASE_DIR
      dockerfile: $DOCKER_DIR/TIM.python_v3.10.Dockerfile

  redis:
    env_file: $TIM_ENV_FILE
    image: redis:7.0.11
    container_name: redis
    restart: always
    ports:
      - ${REDIS__PORT}:${REDIS__PORT}
    volumes:
      - redisdata:/data

  elasticsearch:
    env_file: $TIM_ENV_FILE
    image: docker.elastic.co/elasticsearch/elasticsearch:8.8.2
    container_name: elasticsearch
    volumes:
      - esdata:/usr/share/elasticsearch/data
    environment:
      - discovery.type=single-node
      - xpack.ml.enabled=false
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms${ELASTIC_MEMORY_SIZE} -Xmx${ELASTIC_MEMORY_SIZE}"
    restart: always
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    ports:
      - 9200:9200
      - 9300:9300

  minio:
    env_file: $TIM_ENV_FILE
    image: minio/minio:RELEASE.2023-05-18T00-05-36Z
    container_name: minio
    volumes:
      - s3data:/data
    ports:
      - ${MINIO__PORT}:${MINIO__PORT}
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
    command: server /data --console-address ":9001"
    healthcheck:
      test:
        [
          "CMD",
          "curl",
          "-f",
          "http://minio:9000/minio/health/live"
        ]
      interval: 30s
      timeout: 20s
      retries: 3
    restart: always

  rabbitmq:
    env_file: $TIM_ENV_FILE
    image: rabbitmq:3.12-management
    container_name: rabbitmq
    volumes:
      - amqpdata:/var/lib/rabbitmq
    ports:
      - ${RABBITMQ__PORT}:${RABBITMQ__PORT}
      - 15672:15672
    restart: always

  opencti:
    env_file: $TIM_ENV_FILE
    extends:
      file: $BASE_DIR/$OPENCTI/opencti-platform/TIM.docker-compose.yml
      service: opencti
    build:
      context: $BASE_DIR/$OPENCTI/opencti-platform/
    depends_on:
      - tim_python_v3.10
      - redis
      - elasticsearch
      - minio
      - rabbitmq
    ports:
      - ${OPENCTI_BASE_PORT}:${OPENCTI_BASE_PORT}
    restart: always

  worker:
    env_file: $TIM_ENV_FILE
    extends:
      file: $BASE_DIR/$OPENCTI/opencti-worker/TIM.docker-compose.yml
      service: worker
    build:
      context: $BASE_DIR/$OPENCTI/opencti-worker/
    depends_on:
      - tim_python_v3.10
      - opencti
    deploy:
      mode: replicated
      replicas: 3
    restart: always

  # connector-import-extraction:
  #   environment:
  #     VISIBILITY: PRIVATE
  #   env_file:
  #     - $TIM_ENV_FILE
  #   extends:
  #     file: $BASE_DIR/$CONNECTORS/internal-import-file/import-extraction/TIM.docker-compose.yml
  #     service: connector-import-extraction
  #   build:
  #     context: $BASE_DIR/$CONNECTORS/internal-import-file/import-extraction/
  #   depends_on:
  #     - tim_python_v3.10
  #     - opencti
  #     - worker
  #     - extractor_service
  #   restart: always

  # extractor_service:
  #   environment:
  #     VISIBILITY: PRIVATE
  #   container_name: extractor_service
  #   extends:
  #     file: $BASE_DIR/cygnus/extractor/docker-compose.yml
  #     service: extractor_service

  connector-actor-import:
    env_file: $TIM_ENV_FILE
    extends:
      file: $BASE_DIR/$CONNECTORS/internal-import-file/import-actor/TIM.docker-compose.yml
      service: connector-import-actor
    build:
      context: $BASE_DIR/$CONNECTORS/internal-import-file/import-actor/
    depends_on:
      - tim_python_v3.10
      - opencti
      - worker
    restart: always

  connector-import-file-stix:
    env_file: $TIM_ENV_FILE
    extends:
      file: $BASE_DIR/$CONNECTORS/internal-import-file/import-file-stix/TIM.docker-compose.yml
      service: connector-import-file-stix
    build:
      context: $BASE_DIR/$CONNECTORS/internal-import-file/import-file-stix/
    depends_on:
      - tim_python_v3.10
      - opencti
      - worker
    restart: always

  connector-import-document:
    env_file: $TIM_ENV_FILE
    image: opencti/connector-import-document:5.8.7
    environment:
      - OPENCTI_URL=$OPENCTI_URL
      - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
      - CONNECTOR_ID=${CONNECTOR_IMPORT_DOCUMENT_ID} # Valid UUIDv4
      - CONNECTOR_TYPE=INTERNAL_IMPORT_FILE
      - CONNECTOR_NAME=ImportDocument
      - CONNECTOR_VALIDATE_BEFORE_IMPORT=true # Validate any bundle before import
      - CONNECTOR_SCOPE=application/pdf,text/plain,text/html
      - CONNECTOR_AUTO=false # Enable/disable auto-import of file
      - CONNECTOR_ONLY_CONTEXTUAL=false # Only extract data related to an entity (a report, a threat actor, etc.)
      - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
      - CONNECTOR_LOG_LEVEL=info
      - IMPORT_DOCUMENT_CREATE_INDICATOR=true
    restart: always
    depends_on:
      - opencti
      - worker

  connector-opencti:
    env_file: $TIM_ENV_FILE
    image: opencti/connector-opencti:5.8.7
    environment:
      - OPENCTI_URL=$OPENCTI_URL
      - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
      - CONNECTOR_ID=7DFC7ECC-3314-4243-BEA1-80B6AC67E276
      - CONNECTOR_TYPE=EXTERNAL_IMPORT
      - CONNECTOR_NAME=OpenCTI
      - CONNECTOR_SCOPE=marking-definition,identity,location
      - CONNECTOR_CONFIDENCE_LEVEL=90 # From 0 (Unknown) to 100 (Fully trusted)
      - CONNECTOR_UPDATE_EXISTING_DATA=false
      - CONNECTOR_RUN_AND_TERMINATE=false
      - CONNECTOR_LOG_LEVEL=info
      - CONFIG_SECTORS_FILE_URL=https://raw.githubusercontent.com/OpenCTI-Platform/datasets/master/data/sectors.json
      - CONFIG_GEOGRAPHY_FILE_URL=https://raw.githubusercontent.com/OpenCTI-Platform/datasets/master/data/geography.json
      - CONFIG_INTERVAL=7 # In days, must be strictly greater than 1
    depends_on:
      - opencti
      - worker
    restart: always

    #
    # uncomment the following connectors to select
    #

    # connector-export-file-stix:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-export-file-stix:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=${CONNECTOR_EXPORT_FILE_STIX_ID} # Valid UUIDv4
    #     - CONNECTOR_TYPE=INTERNAL_EXPORT_FILE
    #     - CONNECTOR_NAME=ExportFileStix2
    #     - CONNECTOR_SCOPE=application/json
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_LOG_LEVEL=info
    #   restart: always
    #   depends_on:
    #     - opencti

    # connector-export-file-csv:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-export-file-csv:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=${CONNECTOR_EXPORT_FILE_CSV_ID} # Valid UUIDv4
    #     - CONNECTOR_TYPE=INTERNAL_EXPORT_FILE
    #     - CONNECTOR_NAME=ExportFileCsv
    #     - CONNECTOR_SCOPE=text/csv
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_LOG_LEVEL=info
    #   restart: always
    #   depends_on:
    #     - opencti


    # connector-export-file-txt:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-export-file-txt:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=${CONNECTOR_EXPORT_FILE_TXT_ID} # Valid UUIDv4
    #     - CONNECTOR_TYPE=INTERNAL_EXPORT_FILE
    #     - CONNECTOR_NAME=ExportFileTxt
    #     - CONNECTOR_SCOPE=text/plain
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_LOG_LEVEL=info
    #   restart: always
    #   depends_on:
    #     - opencti


    # connector-alienvault:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-alienvault:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=2F41B65A-9BE6-42AD-B979-781B4E6532A3
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=AlienVault
    #     - CONNECTOR_SCOPE=alienvault
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - ALIENVAULT_BASE_URL=https://otx.alienvault.com
    #     - ALIENVAULT_API_KEY=1bf5c022b6ed562af0c8b1f928d047bed32d0978ab0aff73ec96ec014a508e51
    #     - ALIENVAULT_TLP=White
    #     - ALIENVAULT_CREATE_OBSERVABLES=true
    #     - ALIENVAULT_CREATE_INDICATORS=true
    #     - ALIENVAULT_PULSE_START_TIMESTAMP=2020-05-01T00:00:00 # BEWARE! Could be a lot of pulses!
    #     - ALIENVAULT_REPORT_TYPE=threat-report
    #     - ALIENVAULT_REPORT_STATUS=New
    #     - ALIENVAULT_GUESS_MALWARE=false # Use tags to guess malware.
    #     - ALIENVAULT_GUESS_CVE=false # Use tags to guess CVE.
    #     - ALIENVAULT_EXCLUDED_PULSE_INDICATOR_TYPES=FileHash-MD5,FileHash-SHA1 # Excluded Pulse indicator types.
    #     - ALIENVAULT_ENABLE_RELATIONSHIPS=true # Enable/Disable relationship creation between SDOs.
    #     - ALIENVAULT_ENABLE_ATTACK_PATTERNS_INDICATES=true # Enable/Disable "indicates" relationships between indicators and attack patterns
    #     - ALIENVAULT_INTERVAL_SEC=1800
    #   restart: always
    #   depends_on:
    #     - opencti


    # connector-cisa-known-exploited-vulnerabilities:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-cisa-known-exploited-vulnerabilities:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=4C28A8A7-4480-41A2-B50F-F9E4622C96DF
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=CISA Known Exploited Vulnerabilities"
    #     - CONNECTOR_SCOPE=identity,vulnerability
    #     - CONNECTOR_CONFIDENCE_LEVEL=50 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_RUN_AND_TERMINATE=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - CISA_CATALOG_URL=https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json
    #     - MITRE_INTERVAL=2 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-amitt:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-amitt:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=96BE59E6-BBEA-4457-A0D6-E4609BFBC210
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=AM!TT
    #     - CONNECTOR_SCOPE=identity,attack-pattern,course-of-action,intrusion-set,malware,tool,report
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - AMITT_FILE_URL=https://raw.githubusercontent.com/VVX7/cti/master/amitt-attack/amitt-attack.json
    #     - PRE_AMITT_FILE_URL=https://raw.githubusercontent.com/VVX7/cti/master/amitt-pre-attack/amitt-pre-attack.json
    #     - AMITT_INTERVAL=7 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-cryptolaemus:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-cryptolaemus:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=DB69F172-9B5D-41F3-B352-4F2617399863
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=Cryptolaemus
    #     - CONNECTOR_SCOPE=cryptolaemus
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-cve:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-cve:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=0826C0E8-86CE-47BD-A2F3-751288F2289E
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=Common Vulnerabilities and Exposures
    #     - CONNECTOR_SCOPE=identity,vulnerability
    #     - CONNECTOR_CONFIDENCE_LEVEL=75 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_RUN_AND_TERMINATE=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - CVE_IMPORT_HISTORY=true # Import history at the first run (after only recent), reset the connector state if you want to re-import
    #     - CVE_NVD_DATA_FEED=https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-recent.json.gz
    #     - CVE_HISTORY_DATA_FEED=https://nvd.nist.gov/feeds/json/cve/1.1/
    #     - CVE_INTERVAL=7 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-cyber-campaign-collection:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-cyber-campaign-collection:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=F4F2741B-CADC-4C10-866E-457DC81F6D9B
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=APT & Cybercriminals Campaign Collection"
    #     - CONNECTOR_SCOPE=report
    #     - CONNECTOR_CONFIDENCE_LEVEL=0 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_RUN_AND_TERMINATE=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - CYBER_MONITOR_GITHUB_TOKEN= # If not provided, rate limit will be very low
    #     - CYBER_MONITOR_FROM_YEAR=2018
    #     - CYBER_MONITOR_INTERVAL=4 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-cybercrimetracker:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-cybercrime-tracker:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=FB5628FE-62E3-4809-ADD8-F3EE2DEE02AF
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=Cybercrime-Tracker
    #     - CONNECTOR_SCOPE=cybercrime-tracker
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - CYBERCRIME_TRACKER_FEED_URL=http://cybercrime-tracker.net/rss.xml
    #     - CYBERCRIME_TRACKER_TLP=WHITE
    #     - CYBERCRIME_TRACKER_INTERVAL=86400
    #     - CYBERCRIME_TRACKER_CREATE_INDICATORS=true
    #     - CYBERCRIME_TRACKER_CREATE_OBSERVABLES=true
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-malware-bazaar-recent-additions:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-malwarebazaar-recent-additions:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=1F25B3D8-5F84-4919-B849-86F5DA666E19
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=MalwareBazaar Recent Additions"
    #     - CONNECTOR_CONFIDENCE_LEVEL=50 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_API_URL=https://mb-api.abuse.ch/api/v1/
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_COOLDOWN_SECONDS=300 # Time to wait in seconds between subsequent requests
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_INCLUDE_TAGS=exe,dll,docm,docx,doc,xls,xlsx,xlsm,js # (Optional) Only download files if any tag matches. (Comma separated)
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_INCLUDE_REPORTERS= # (Optional) Only download files uploaded by these reporters. (Comma separated)
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_LABELS=malware-bazar # (Optional) Labels to apply to uploaded Artifacts. (Comma separated)
    #     - MALWAREBAZAAR_RECENT_ADDITIONS_LABELS_COLOR=#54483b # Color to use for labels
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-mitre:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-mitre:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=C23C6160-A6C5-4035-BBEA-3D45C9F018F8
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=MITRE Datasets"
    #     - CONNECTOR_SCOPE=marking-definition,identity,attack-pattern,course-of-action,intrusion-set,campaign,malware,tool,report,external-reference-as-report
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_RUN_AND_TERMINATE=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - MITRE_ENTERPRISE_FILE_URL=https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json
    #     - MITRE_PRE_ATTACK_FILE_URL=https://raw.githubusercontent.com/mitre/cti/master/pre-attack/pre-attack.json
    #     - MITRE_MOBILE_ATTACK_FILE_URL=https://raw.githubusercontent.com/mitre/cti/master/mobile-attack/mobile-attack.json
    #     - MITRE_ICS_ATTACK_FILE_URL=https://raw.githubusercontent.com/mitre/cti/master/ics-attack/ics-attack.json
    #     - MITRE_CAPEC_FILE_URL=https://raw.githubusercontent.com/mitre/cti/master/capec/2.1/stix-capec.json
    #     - MITRE_INTERVAL=7 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-sekoia:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-sekoia:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=16AD4752-F189-43BD-B649-EB256CC3C39F
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - CONNECTOR_NAME=SEKOIA.IO
    #     - CONNECTOR_SCOPE=identity,attack-pattern,course-of-action,intrusion-set,malware,tool,report,location,vulnerability,indicator
    #     - CONNECTOR_CONFIDENCE_LEVEL=15 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - SEKOIA_API_KEY=ChangeMe
    #     - SEKOIA_START_DATE=2022-01-01 # Optional, the date to start consuming data from. Maybe in the formats YYYY-MM-DD or YYYY-MM-DDT00:00:00
    #     - SEKOIA_CREATE_OBSERVABLES=true # Create observables from indicators 
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-urlhaus-recent-payloads:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-urlhaus-recent-payloads:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=C68CA304-7E93-4C38-B181-AE50EE0C057A
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=URLHaus Recent Payloads"
    #     - CONNECTOR_CONFIDENCE_LEVEL=50 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - URLHAUS_RECENT_PAYLOADS_API_URL=https://urlhaus-api.abuse.ch/v1/
    #     - URLHAUS_RECENT_PAYLOADS_COOLDOWN_SECONDS=300 # Time to wait in seconds between subsequent requests
    #     - URLHAUS_RECENT_PAYLOADS_INCLUDE_FILETYPES=exe,dll,docm,docx,doc,xls,xlsx,xlsm,js,xll # (Optional) Only download files if any tag matches. (Comma separated)
    #     - URLHAUS_RECENT_PAYLOADS_INCLUDE_SIGNATURES= # (Optional) Only download files uploaded by these reporters. (Comma separated)
    #     - URLHAUS_RECENT_PAYLOADS_SKIP_UNKNOWN_FILETYPES=true # Skip files with an unknown file type
    #     - URLHAUS_RECENT_PAYLOADS_SKIP_NULL_SIGNATURE=true # Skip files that didn't match known Yara signatures
    #     - URLHAUS_RECENT_PAYLOADS_LABELS=urlhaus # (Optional) Labels to apply to uploaded Artifacts. (Comma separated)
    #     - URLHAUS_RECENT_PAYLOADS_LABELS_COLOR=#54483b
    #     - URLHAUS_RECENT_PAYLOADS_SIGNATURE_LABEL_COLOR=#0059f7 # Color for signature match label
    #     - URLHAUS_RECENT_PAYLOADS_FILETYPE_LABEL_COLOR=#54483b # Color to use for filetype label
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-urlhaus:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-urlhaus:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=64421E6A-3C42-4F4D-A4EB-0D1CAF613549
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=Abuse.ch URLhaus"
    #     - CONNECTOR_SCOPE=urlhaus
    #     - CONNECTOR_CONFIDENCE_LEVEL=40 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - URLHAUS_CSV_URL=https://urlhaus.abuse.ch/downloads/csv_recent/
    #     - URLHAUS_IMPORT_OFFLINE=true
    #     - URLHAUS_CREATE_INDICATORS=true
    #     - URLHAUS_INTERVAL=3 # In days, must be strictly greater than 1
    #   restart: always
    #   depends_on:
    #     - opencti
    # connector-vxvault:
    #   env_file:
    #     - $TIM_ENV_FILE
    #   image: opencti/connector-vxvault:5.8.7
    #   environment:
    #     - OPENCTI_URL=${OPENCTI_URL}
    #     - OPENCTI_TOKEN=${OPENCTI_ADMIN_TOKEN}
    #     - CONNECTOR_ID=8DE924A7-68C4-4233-9078-1C200E96FA97
    #     - CONNECTOR_TYPE=EXTERNAL_IMPORT
    #     - "CONNECTOR_NAME=VX Vault URL list"
    #     - CONNECTOR_SCOPE=vxvault
    #     - CONNECTOR_CONFIDENCE_LEVEL=40 # From 0 (Unknown) to 100 (Fully trusted)
    #     - CONNECTOR_UPDATE_EXISTING_DATA=false
    #     - CONNECTOR_LOG_LEVEL=info
    #     - VXVAULT_URL=http://vxvault.net/URL_List.php
    #     - VXVAULT_CREATE_INDICATORS=true
    #     - VXVAULT_INTERVAL=3 # In days, must be strictly greater than 1
    #   restart: always



volumes:
  esdata:
  s3data:
  redisdata:
  amqpdata:


networks:
  tim-network:
    external: true